<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOS Ultimate | AI Powered</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Phosphor Icons & FontAwesome -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #F8FAFC;
            --text-primary: #0F172A;
            --accent-primary: #6366F1; /* Indigo Moderno */
            --accent-secondary: #8B5CF6; /* Roxo AI */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-primary); -webkit-font-smoothing: antialiased; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94A3B8; }

        /* Anima√ß√µes e Transi√ß√µes */
        .tab-content { display: none; animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-3px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }

        /* AI Elements */
        .ai-gradient { background: linear-gradient(135deg, #6366F1 0%, #A855F7 100%); }
        .ai-text { background: linear-gradient(135deg, #6366F1 0%, #A855F7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .ai-border { position: relative; }
        .ai-border::before { content: ''; position: absolute; inset: 0; padding: 2px; border-radius: inherit; background: linear-gradient(135deg, #6366F1, #A855F7); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask-composite: exclude; pointer-events: none; opacity: 0.5; }

        /* Floating AI Chat */
        .ai-assistant-btn {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            border-radius: 50%; background: var(--text-primary); color: white;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4); cursor: pointer; z-index: 50;
            transition: transform 0.2s;
        }
        .ai-assistant-btn:hover { transform: scale(1.1); }
        
        .ai-chat-window {
            position: fixed; bottom: 100px; right: 30px; width: 350px; height: 500px;
            background: white; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            z-index: 49; display: none; flex-direction: column; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.8); backdrop-filter: blur(10px);
        }
        .ai-chat-window.open { display: flex; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Contenteditable */
        [contenteditable="true"]:focus { outline: none; background-color: #F1F5F9; border-radius: 4px; padding: 0 4px; }
        
        /* Sidebar Active */
        .nav-item.active { background-color: #EEF2FF; color: var(--accent-primary); border-right: 3px solid var(--accent-primary); font-weight: 600; }

        /* Calendar */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { min-height: 100px; border-radius: 12px; transition: all 0.2s; cursor: pointer; border: 1px solid #E2E8F0; background: white; }
        .calendar-day:hover { border-color: var(--accent-primary); }
        .calendar-day.today { border: 2px solid var(--accent-primary); background-color: #EEF2FF; }

        /* Progress Bars */
        .progress-bar-bg { background-color: #E2E8F0; border-radius: 999px; overflow: hidden; }
        .progress-bar-fill { height: 100%; border-radius: 999px; transition: width 0.6s ease-out; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- SIDEBAR -->
    <nav class="w-20 md:w-64 bg-white border-r border-slate-200 flex flex-col justify-between flex-shrink-0 z-20 shadow-sm">
        <div>
            <div class="h-20 flex items-center justify-center md:justify-start md:px-6 border-b border-slate-100">
                <div class="w-10 h-10 rounded-xl ai-gradient text-white flex items-center justify-center text-xl font-bold shadow-lg shadow-indigo-200">
                    <i class="fas fa-brain"></i>
                </div>
                <span class="ml-3 font-bold text-xl hidden md:block tracking-tight text-slate-800">LifeOS <span class="text-xs text-indigo-500 align-top">AI</span></span>
            </div>

            <ul class="flex flex-col py-6 space-y-1 px-2">
                <li><button onclick="switchTab('dashboard')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition active" id="btn-dashboard"><i class="ph ph-squares-four text-xl"></i><span class="ml-3 hidden md:block">Vis√£o Geral</span></button></li>
                <li><button onclick="switchTab('daily')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-daily"><i class="ph ph-sun text-xl"></i><span class="ml-3 hidden md:block">Agenda do Dia</span></button></li>
                <li><button onclick="switchTab('weekly')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-weekly"><i class="ph ph-calendar-blank text-xl"></i><span class="ml-3 hidden md:block">Semana</span></button></li>
                <li><button onclick="switchTab('monthly')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-monthly"><i class="ph ph-calendar text-xl"></i><span class="ml-3 hidden md:block">M√™s</span></button></li>
                <!-- NOVA ABA DE METAS -->
                <li><button onclick="switchTab('goals')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-goals"><i class="ph ph-target text-xl"></i><span class="ml-3 hidden md:block">Metas Globais</span></button></li>
                
                <li class="pt-4 pb-2"><div class="text-xs font-bold text-slate-400 uppercase px-3 hidden md:block">√Åreas</div></li>
                
                <li><button onclick="switchTab('finances')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-finances"><i class="ph ph-currency-dollar text-xl"></i><span class="ml-3 hidden md:block">Finan√ßas</span></button></li>
                <li><button onclick="switchTab('study')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-study"><i class="ph ph-student text-xl"></i><span class="ml-3 hidden md:block">Nexus Estudos</span></button></li>
                <li><button onclick="switchTab('routine')" class="nav-item w-full flex items-center p-3 rounded-lg text-slate-500 hover:bg-slate-50 transition" id="btn-routine"><i class="ph ph-check-circle text-xl"></i><span class="ml-3 hidden md:block">H√°bitos</span></button></li>
            </ul>
        </div>
        
        <div class="p-4 border-t border-slate-100">
            <button onclick="exportData()" class="flex items-center text-xs text-slate-400 hover:text-indigo-600 transition"><i class="ph ph-download mr-2"></i> <span class="hidden md:inline">Backup</span></button>
            <input type="file" id="import-file" class="hidden" onchange="importData(this)">
            <label for="import-file" class="flex items-center text-xs text-slate-400 hover:text-indigo-600 transition mt-2 cursor-pointer"><i class="ph ph-upload mr-2"></i> <span class="hidden md:inline">Restaurar</span></label>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-hidden bg-[#F8FAFC] relative">
        <div class="h-full overflow-y-auto p-4 md:p-8 pb-32">
            
            <!-- HEADER COMUM -->
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800" id="header-title">Ol√°!</h1>
                    <p class="text-slate-500 text-sm flex items-center gap-2">
                        <span id="current-date"></span>
                        <span class="bg-indigo-50 text-indigo-600 px-2 py-0.5 rounded text-xs font-bold border border-indigo-100 flex items-center gap-1">
                            <i class="fas fa-bolt"></i> LifeAI Ativo
                        </span>
                    </p>
                </div>
                <div class="flex gap-3">
                    <!-- Status de Produtividade (Simulado) -->
                    <div class="hidden md:flex flex-col items-end">
                        <span class="text-xs text-slate-400 uppercase font-bold">Produtividade</span>
                        <div class="flex items-center gap-1 text-green-600 font-bold text-sm"><i class="fas fa-chart-line"></i> Alta</div>
                    </div>
                </div>
            </header>

            <!-- 1. DASHBOARD -->
            <section id="dashboard" class="tab-content active">
                <!-- AI Insight Banner -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white mb-8 shadow-lg relative overflow-hidden group">
                    <div class="absolute top-0 right-0 opacity-10 transform translate-x-10 -translate-y-10"><i class="fas fa-brain text-9xl"></i></div>
                    <h2 class="text-xl font-bold mb-2 flex items-center gap-2"><i class="fas fa-lightbulb text-yellow-300"></i> Insight do Dia</h2>
                    <p id="ai-daily-insight" class="text-indigo-100 text-lg font-light max-w-2xl">Carregando an√°lise da sua rotina...</p>
                    <button onclick="LifeAI.generateInsight()" class="mt-4 bg-white/20 hover:bg-white/30 text-white px-4 py-1.5 rounded-full text-xs font-medium transition backdrop-blur-sm">Gerar Novo Insight</button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Foco do Dia -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="font-bold text-slate-700 flex items-center gap-2"><i class="ph ph-target text-indigo-500"></i> Foco Principal</h3>
                            <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">Prioridade M√°xima</span>
                        </div>
                        <div class="space-y-4" id="dash-focus-list">
                            <!-- Injetado via JS -->
                        </div>
                        <button onclick="switchTab('daily')" class="w-full mt-4 text-center text-sm text-indigo-500 hover:text-indigo-700 font-medium py-2 border border-dashed border-indigo-200 rounded-lg hover:bg-indigo-50 transition">Gerenciar Tarefas do Dia</button>
                    </div>

                    <!-- Resumo R√°pido -->
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2"><i class="ph ph-chart-pie-slice text-purple-500"></i> Balanceamento</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-xs text-slate-500 mb-1"><span>Estudos</span><span>65%</span></div>
                                    <div class="w-full bg-slate-100 rounded-full h-2"><div class="bg-purple-500 h-2 rounded-full" style="width: 65%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs text-slate-500 mb-1"><span>Metas Financeiras</span><span>40%</span></div>
                                    <div class="w-full bg-slate-100 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full" style="width: 40%"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs text-slate-500 mb-1"><span>H√°bitos</span><span>80%</span></div>
                                    <div class="w-full bg-slate-100 rounded-full h-2"><div class="bg-blue-500 h-2 rounded-full" style="width: 80%"></div></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. DAILY AGENDA COM METAS SMART -->
            <section id="daily" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Coluna Esquerda: Metas do Dia (AI) -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-fit">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-slate-700">Metas do Dia</h3>
                            <button onclick="LifeAI.suggestDailyGoals()" class="text-xs ai-gradient text-white px-2 py-1 rounded shadow-sm hover:opacity-90 transition"><i class="fas fa-magic mr-1"></i> Sugerir</button>
                        </div>
                        <div id="daily-goals-container" class="space-y-3">
                            <!-- Metas Smart Inseridas Aqui -->
                        </div>
                        <button onclick="addDailyGoal()" class="mt-4 w-full text-xs text-slate-400 hover:text-indigo-500 border border-dashed border-slate-200 p-2 rounded hover:border-indigo-300 transition">+ Adicionar Meta</button>
                    </div>

                    <!-- Coluna Direita: Tarefas e Agenda -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- AI Alert Box -->
                        <div id="daily-ai-alert" class="hidden bg-orange-50 border border-orange-100 p-3 rounded-lg flex items-start gap-3 text-sm text-orange-800">
                            <i class="fas fa-exclamation-triangle mt-0.5"></i>
                            <div>
                                <span class="font-bold">Aten√ß√£o:</span> <span id="daily-ai-msg">Sua carga hor√°ria parece excessiva. A IA sugere adiar 1 tarefa n√£o essencial.</span>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4">Lista de Tarefas</h3>
                            <div id="task-list" class="space-y-2"></div>
                            <div class="flex gap-2 mt-4">
                                <input type="text" id="new-task-input" placeholder="Nova tarefa..." class="flex-1 bg-slate-50 border border-slate-200 rounded-lg px-4 py-2 text-sm focus:ring-2 focus:ring-indigo-100 outline-none">
                                <button onclick="addTask()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"><i class="fas fa-plus"></i></button>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-2">Notas R√°pidas</h3>
                            <div id="daily-notes" contenteditable="true" class="w-full min-h-[100px] text-sm text-slate-600 bg-slate-50 p-4 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-50 outline-none" data-placeholder="Ideias, lembretes..."></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. METAS GLOBAIS (NOVO) -->
            <section id="goals" class="tab-content">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-slate-800">Painel de Metas & Objetivos</h2>
                    <button onclick="LifeAI.analyzeGoals()" class="bg-indigo-50 text-indigo-600 px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-100 transition"><i class="fas fa-chart-network mr-2"></i>An√°lise de Conflitos (AI)</button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="global-goals-grid">
                    <!-- Cards de Metas gerados via JS -->
                </div>
            </section>

            <!-- 4. NEXUS ESTUDOS (ATUALIZADO) -->
            <section id="study" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-[calc(100vh-150px)]">
                    <!-- Sidebar Interna Nexus -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4 flex flex-col gap-2">
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Nexus v3.0</div>
                        <button onclick="renderNexusDashboard()" class="text-left px-4 py-2 rounded-lg bg-indigo-50 text-indigo-700 font-medium text-sm">Dashboard</button>
                        <button onclick="renderNexusLibrary()" class="text-left px-4 py-2 rounded-lg hover:bg-slate-50 text-slate-600 text-sm transition">Biblioteca</button>
                        <button onclick="openFlashcardModal()" class="text-left px-4 py-2 rounded-lg hover:bg-slate-50 text-slate-600 text-sm transition flex items-center justify-between">Flashcards <span class="bg-purple-100 text-purple-600 text-[10px] px-1.5 py-0.5 rounded">AI</span></button>
                        
                        <div class="mt-auto bg-slate-50 p-4 rounded-xl text-center">
                            <div class="text-3xl font-mono font-bold text-slate-700 mb-2" id="nexus-timer">25:00</div>
                            <button onclick="toggleStudyTimer()" id="nexus-timer-btn" class="w-full bg-slate-800 text-white py-2 rounded-lg text-sm hover:bg-black transition">Focar</button>
                        </div>
                    </div>

                    <!-- √Årea Principal Nexus -->
                    <div class="lg:col-span-3 bg-white rounded-2xl shadow-sm border border-slate-100 p-6 overflow-y-auto relative">
                        <div id="nexus-content-area">
                            <!-- Conte√∫do din√¢mico aqui -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. FINAN√áAS (COM PREVIS√ÉO AI) -->
            <section id="finances" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100"><p class="text-xs text-slate-400 font-bold uppercase">Saldo</p><h3 class="text-2xl font-bold text-slate-800 mt-1" id="fin-balance">R$ 0,00</h3></div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100"><p class="text-xs text-green-500 font-bold uppercase">Entradas</p><h3 class="text-2xl font-bold text-green-600 mt-1" id="fin-income">R$ 0,00</h3></div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100"><p class="text-xs text-red-500 font-bold uppercase">Sa√≠das</p><h3 class="text-2xl font-bold text-red-600 mt-1" id="fin-expense">R$ 0,00</h3></div>
                </div>

                <!-- AI Prediction Box -->
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-4 mb-8 flex items-start gap-4">
                    <div class="bg-white p-2 rounded-full text-indigo-600 shadow-sm"><i class="fas fa-robot"></i></div>
                    <div>
                        <h4 class="font-bold text-indigo-900 text-sm">Previs√£o Financeira AI</h4>
                        <p class="text-sm text-indigo-700 mt-1" id="fin-ai-prediction">Analisando gastos... Adicione transa√ß√µes para gerar previs√µes.</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Transaction Form & List -->
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4">Nova Transa√ß√£o</h3>
                            <div class="grid grid-cols-2 gap-3 mb-3">
                                <select id="trans-type" class="p-2 border border-slate-200 rounded-lg text-sm bg-slate-50"><option value="expense">Sa√≠da</option><option value="income">Entrada</option></select>
                                <input type="number" id="trans-val" placeholder="Valor" class="p-2 border border-slate-200 rounded-lg text-sm bg-slate-50">
                            </div>
                            <input type="text" id="trans-desc" placeholder="Descri√ß√£o (ex: Mercado)" class="w-full p-2 border border-slate-200 rounded-lg text-sm bg-slate-50 mb-3">
                            <button onclick="addTransaction()" class="w-full bg-slate-800 text-white py-2 rounded-lg text-sm hover:bg-black transition">Registrar</button>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                            <h3 class="font-bold text-slate-700 mb-4">Hist√≥rico</h3>
                            <div id="transaction-list" class="space-y-2 max-h-64 overflow-y-auto"></div>
                        </div>
                    </div>
                    <!-- Analysis -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h3 class="font-bold text-slate-700 mb-4">An√°lise por Categoria</h3>
                        <div id="fin-categories" class="space-y-4"></div>
                    </div>
                </div>
            </section>

            <!-- 6. OUTRAS ABAS (Monthly, Routine, Weekly) - Mantidas simplificadas para caber -->
            <section id="monthly" class="tab-content">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold text-slate-800" id="cal-title">M√™s</h2><div class="flex gap-2"><button onclick="changeMonth(-1)" class="p-2 hover:bg-slate-100 rounded"><i class="fas fa-chevron-left"></i></button><button onclick="changeMonth(1)" class="p-2 hover:bg-slate-100 rounded"><i class="fas fa-chevron-right"></i></button></div></div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>
            </section>
            
            <section id="weekly" class="tab-content">
                <div class="flex justify-between mb-6">
                    <h2 class="text-xl font-bold text-slate-800">Planejamento Semanal</h2>
                    <button onclick="LifeAI.analyzeWeek()" class="text-xs bg-purple-50 text-purple-600 px-3 py-1 rounded hover:bg-purple-100"><i class="fas fa-magic mr-1"></i> Analisar Semana</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="weekly-cards"></div>
            </section>

            <section id="routine" class="tab-content">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h2 class="text-xl font-bold text-slate-800 mb-6">Rastreador de H√°bitos</h2>
                    <div id="habit-tracker-container"></div>
                    <button onclick="addHabit()" class="mt-4 text-sm text-indigo-600 font-medium">+ Novo H√°bito</button>
                </div>
            </section>

        </div>
    </main>

    <!-- AI CHAT BUBBLE -->
    <div class="ai-assistant-btn ai-gradient" onclick="toggleAIChat()">
        <i class="fas fa-robot text-2xl"></i>
    </div>

    <!-- AI CHAT WINDOW -->
    <div class="ai-chat-window" id="ai-chat-window">
        <div class="bg-slate-900 text-white p-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                <span class="font-bold text-sm">LifeOS Assistant</span>
            </div>
            <button onclick="toggleAIChat()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <div class="flex-1 p-4 overflow-y-auto space-y-3 bg-slate-50" id="ai-chat-messages">
            <div class="flex justify-start"><div class="bg-white border border-slate-200 text-slate-700 p-3 rounded-2xl rounded-tl-none text-sm max-w-[85%] shadow-sm">Ol√°! Sou sua IA pessoal. Analisei seus dados locais. Como posso ajudar a organizar seu dia hoje?</div></div>
        </div>
        <div class="p-3 bg-white border-t border-slate-200">
            <form onsubmit="handleAIChat(event)" class="flex gap-2">
                <input type="text" id="ai-chat-input" placeholder="Pergunte algo..." class="flex-1 bg-slate-100 border-none rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-indigo-100 outline-none">
                <button type="submit" class="bg-indigo-600 text-white w-9 h-9 rounded-full flex items-center justify-center hover:bg-indigo-700"><i class="fas fa-paper-plane text-xs"></i></button>
            </form>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        const DB_KEY = 'LifeOS_Ultimate_DB';
        
        // --- ESTRUTURA DE DADOS ROBUSTA ---
        let db = {
            tasks: [], // {id, text, done, date}
            goals: { daily: [], weekly: [], monthly: [], global: [] },
            finances: { transactions: [], budget: 2000 },
            nexus: { sessions: [], flashcards: [], xp: 0, level: 1 },
            habits: [],
            settings: { theme: 'light', aiLevel: 'high' }
        };

        // --- LIFE AI ENGINE (MOCK LOGIC) ---
        const LifeAI = {
            generateInsight: () => {
                const msgs = [
                    "Notei que voc√™ completa mais tarefas pela manh√£. Tente agendar o 'Deep Work' para as 9h.",
                    "Sua categoria 'Lazer' nas finan√ßas est√° baixa este m√™s. N√£o esque√ßa de descansar!",
                    "Voc√™ revisou 3 mat√©rias esta semana. √ìtimo ritmo! Mantenha a const√¢ncia.",
                    "Sua taxa de conclus√£o de h√°bitos √© de 85%. Excelente!",
                    "Previs√£o: Com o ritmo atual, voc√™ bater√° sua meta de leitura em 4 dias."
                ];
                const msg = msgs[Math.floor(Math.random() * msgs.length)];
                document.getElementById('ai-daily-insight').innerText = msg;
            },
            
            suggestDailyGoals: () => {
                const suggestions = [
                    {text: "Revisar Finan√ßas da Semana", type: "admin"},
                    {text: "Ler 20 p√°ginas (H√°bito)", type: "study"},
                    {text: "Organizar mesa de trabalho", type: "routine"},
                    {text: "Zero Inbox", type: "work"}
                ];
                const pick = suggestions.sort(() => 0.5 - Math.random()).slice(0, 2);
                pick.forEach(g => {
                    db.goals.daily.push({id: Date.now() + Math.random(), text: g.text, done: false, type: g.type});
                });
                saveDB();
                renderDaily();
            },

            analyzeFinances: () => {
                const totalExp = db.finances.transactions.filter(t => t.type === 'expense').reduce((a,b) => a + b.val, 0);
                const ratio = totalExp / db.finances.budget;
                let msg = "Gastos dentro do normal.";
                if(ratio > 0.8) msg = "‚ö†Ô∏è Alerta: Voc√™ j√° consumiu 80% do or√ßamento mensal!";
                else if(ratio < 0.3 && new Date().getDate() > 20) msg = "ü§ë √ìtimo controle! Sobra de caixa prevista.";
                document.getElementById('fin-ai-prediction').innerText = msg;
            },

            generateFlashcards: (topic) => {
                // Mock generator
                return [
                    {q: `O que √© ${topic}?`, a: "Defini√ß√£o do conceito chave."},
                    {q: "Quais os 3 pilares principais?", a: "Pilar 1, 2 e 3."},
                    {q: "Como aplicar na pr√°tica?", a: "Exemplo pr√°tico de uso."}
                ];
            }
        };

        // --- CORE FUNCTIONS ---
        function init() {
            loadDB();
            updateDate();
            renderDashboard();
            LifeAI.generateInsight();
            
            // Auto-save loop
            setInterval(saveDB, 30000); 
        }

        function loadDB() {
            const saved = localStorage.getItem(DB_KEY);
            if(saved) db = { ...db, ...JSON.parse(saved) };
        }

        function saveDB() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
            // Trigger updates if needed
        }

        function updateDate() {
            const now = new Date();
            document.getElementById('current-date').innerText = now.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            const btn = document.getElementById(`btn-${id}`);
            if(btn) btn.classList.add('active');

            // Render specific tab content
            if(id === 'dashboard') renderDashboard();
            if(id === 'daily') renderDaily();
            if(id === 'goals') renderGoals();
            if(id === 'finances') renderFinances();
            if(id === 'study') renderNexusDashboard();
            if(id === 'weekly') renderWeekly();
            if(id === 'monthly') renderMonthly();
            if(id === 'routine') renderRoutine();
        }

        // --- RENDERERS ---
        function renderDashboard() {
            const list = document.getElementById('dash-focus-list');
            list.innerHTML = '';
            // Get top 3 unfinished daily goals
            const goals = db.goals.daily.filter(g => !g.done).slice(0, 3);
            if(goals.length === 0) list.innerHTML = '<p class="text-slate-400 text-sm italic">Nada pendente. Aproveite o dia! ‚òÄÔ∏è</p>';
            goals.forEach(g => {
                list.innerHTML += `
                    <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100">
                        <div class="w-2 h-2 rounded-full bg-indigo-500"></div>
                        <span class="text-sm font-medium text-slate-700">${g.text}</span>
                    </div>
                `;
            });
        }

        function renderDaily() {
            const container = document.getElementById('daily-goals-container');
            container.innerHTML = '';
            db.goals.daily.forEach(g => {
                container.innerHTML += `
                    <div class="flex items-center gap-2 group">
                        <input type="checkbox" ${g.done ? 'checked' : ''} onchange="toggleGoal('daily', ${g.id})" class="accent-indigo-600 rounded">
                        <input type="text" value="${g.text}" onblur="editGoal('daily', ${g.id}, this.value)" class="flex-1 text-sm bg-transparent border-none focus:bg-slate-50 rounded px-1 ${g.done ? 'line-through text-slate-400' : 'text-slate-700'}">
                        <button onclick="deleteGoal('daily', ${g.id})" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition"><i class="fas fa-times"></i></button>
                    </div>
                `;
            });
            renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            const today = new Date().toISOString().split('T')[0];
            const tasks = db.tasks.filter(t => t.date === today || !t.date); // Show today or backlog
            tasks.forEach(t => {
                list.innerHTML += `
                    <div class="flex items-center gap-3 p-3 bg-white border border-slate-100 rounded-lg hover:shadow-sm transition group">
                        <div onclick="toggleTask(${t.id})" class="w-5 h-5 rounded border cursor-pointer flex items-center justify-center ${t.done ? 'bg-indigo-500 border-indigo-500 text-white' : 'border-slate-300'}">
                            ${t.done ? '<i class="fas fa-check text-xs"></i>' : ''}
                        </div>
                        <span class="flex-1 text-sm ${t.done ? 'text-slate-400 line-through' : 'text-slate-700'}">${t.text}</span>
                        <button onclick="deleteTask(${t.id})" class="text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });
        }

        function renderGoals() {
            const grid = document.getElementById('global-goals-grid');
            grid.innerHTML = '';
            const categories = ['Pessoal', 'Profissional', 'Financeiro'];
            
            categories.forEach(cat => {
                const catGoals = db.goals.global.filter(g => g.category === cat);
                let itemsHtml = '';
                catGoals.forEach(g => {
                    const progress = g.progress || 0;
                    itemsHtml += `
                        <div class="mb-3">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium text-slate-700">${g.text}</span>
                                <span class="text-slate-400 text-xs">${progress}%</span>
                            </div>
                            <div class="w-full bg-slate-100 rounded-full h-1.5 cursor-pointer hover:h-2 transition-all" onclick="updateGoalProgress(${g.id})">
                                <div class="bg-indigo-500 h-full rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                    `;
                });

                grid.innerHTML += `
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 card-hover">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-slate-700">${cat}</h3>
                            <button onclick="addGlobalGoal('${cat}')" class="text-indigo-500 hover:bg-indigo-50 p-1 rounded"><i class="fas fa-plus"></i></button>
                        </div>
                        ${itemsHtml || '<p class="text-xs text-slate-400">Nenhuma meta definida.</p>'}
                    </div>
                `;
            });
        }

        function renderFinances() {
            LifeAI.analyzeFinances();
            const list = document.getElementById('transaction-list');
            list.innerHTML = '';
            let bal = 0, inc = 0, exp = 0, cats = {};
            
            db.finances.transactions.forEach(t => {
                if(t.type === 'income') { bal += t.val; inc += t.val; }
                else { bal -= t.val; exp += t.val; cats[t.cat] = (cats[t.cat] || 0) + t.val; }
                
                list.innerHTML += `
                    <div class="flex justify-between items-center p-3 border-b border-slate-50 text-sm">
                        <span class="text-slate-600">${t.desc}</span>
                        <span class="font-mono font-medium ${t.type === 'income' ? 'text-green-600' : 'text-red-500'}">
                            ${t.type === 'income' ? '+' : '-'} R$ ${t.val}
                        </span>
                    </div>
                `;
            });

            document.getElementById('fin-balance').innerText = `R$ ${bal.toFixed(2)}`;
            document.getElementById('fin-income').innerText = `R$ ${inc.toFixed(2)}`;
            document.getElementById('fin-expense').innerText = `R$ ${exp.toFixed(2)}`;

            // Render Categories
            const catContainer = document.getElementById('fin-categories');
            catContainer.innerHTML = '';
            Object.keys(cats).forEach(c => {
                const pct = (cats[c] / exp) * 100;
                catContainer.innerHTML += `
                    <div class="mb-2">
                        <div class="flex justify-between text-xs text-slate-500 mb-1"><span>${c}</span><span>${pct.toFixed(0)}%</span></div>
                        <div class="w-full bg-slate-100 rounded-full h-1.5"><div class="bg-indigo-400 h-1.5 rounded-full" style="width: ${pct}%"></div></div>
                    </div>
                `;
            });
        }

        // --- NEXUS STUDY LOGIC ---
        function renderNexusDashboard() {
            const area = document.getElementById('nexus-content-area');
            area.innerHTML = `
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                        <h4 class="text-xs font-bold text-indigo-400 uppercase">N√≠vel atual</h4>
                        <div class="text-2xl font-bold text-indigo-700">Lvl ${db.nexus.level}</div>
                        <div class="w-full bg-white rounded-full h-1.5 mt-2"><div class="bg-indigo-500 h-1.5 rounded-full" style="width: ${(db.nexus.xp % 100)}%"></div></div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-xl border border-purple-100">
                        <h4 class="text-xs font-bold text-purple-400 uppercase">Flashcards</h4>
                        <div class="text-2xl font-bold text-purple-700">${db.nexus.flashcards.length}</div>
                    </div>
                </div>
                <h3 class="font-bold text-slate-700 mb-4">Sess√µes Recentes</h3>
                <div class="space-y-3" id="nexus-sessions-list"></div>
            `;
            const list = document.getElementById('nexus-sessions-list');
            if(db.nexus.sessions.length === 0) list.innerHTML = '<p class="text-slate-400 italic text-sm">Nenhuma sess√£o registrada.</p>';
            db.nexus.sessions.slice(0,5).forEach(s => {
                list.innerHTML += `
                    <div class="p-3 border border-slate-100 rounded-lg flex justify-between items-center bg-slate-50">
                        <div>
                            <div class="font-bold text-slate-700 text-sm">${s.topic}</div>
                            <div class="text-xs text-slate-400">${new Date(s.date).toLocaleDateString()} ‚Ä¢ ${s.duration} min</div>
                        </div>
                        <span class="text-xs px-2 py-1 bg-white rounded border border-slate-200">${s.method}</span>
                    </div>
                `;
            });
        }

        // --- ACTIONS ---
        function addDailyGoal() {
            const text = prompt("Nova Meta:");
            if(text) {
                db.goals.daily.push({id: Date.now(), text: text, done: false, type: 'manual'});
                saveDB(); renderDaily();
            }
        }
        function toggleGoal(type, id) {
            const g = db.goals[type].find(x => x.id === id);
            if(g) { g.done = !g.done; saveDB(); if(type==='daily') renderDaily(); }
        }
        function deleteGoal(type, id) {
            db.goals[type] = db.goals[type].filter(x => x.id !== id);
            saveDB(); if(type==='daily') renderDaily();
        }
        function addTask() {
            const input = document.getElementById('new-task-input');
            if(input.value.trim()) {
                db.tasks.push({id: Date.now(), text: input.value, done: false, date: new Date().toISOString().split('T')[0]});
                input.value = '';
                saveDB(); renderTasks();
            }
        }
        function toggleTask(id) {
            const t = db.tasks.find(x => x.id === id);
            if(t) { t.done = !t.done; saveDB(); renderTasks(); }
        }
        function deleteTask(id) {
            db.tasks = db.tasks.filter(x => x.id !== id);
            saveDB(); renderTasks();
        }
        function addTransaction() {
            const type = document.getElementById('trans-type').value;
            const val = parseFloat(document.getElementById('trans-val').value);
            const desc = document.getElementById('trans-desc').value;
            if(desc && val) {
                db.finances.transactions.push({id: Date.now(), type, val, desc, cat: 'Geral', date: new Date().toISOString()});
                saveDB(); renderFinances();
            }
        }
        function addGlobalGoal(cat) {
            const text = prompt(`Nova meta para ${cat}:`);
            if(text) {
                db.goals.global.push({id: Date.now(), category: cat, text: text, progress: 0});
                saveDB(); renderGoals();
            }
        }
        function updateGoalProgress(id) {
            const g = db.goals.global.find(x => x.id === id);
            const newProg = prompt("Nova porcentagem (0-100):", g.progress);
            if(newProg !== null) {
                g.progress = parseInt(newProg);
                saveDB(); renderGoals();
            }
        }

        // --- CALENDAR & WEEKLY (Simples Render placeholders) ---
        function renderMonthly() { 
            const grid = document.getElementById('calendar-grid'); grid.innerHTML = '';
            for(let i=1;i<=30;i++) grid.innerHTML += `<div class="calendar-day p-2 text-sm text-slate-600">${i}</div>`;
        }
        function renderWeekly() {
            const container = document.getElementById('weekly-cards'); container.innerHTML = '';
            ['Seg','Ter','Qua','Qui','Sex','Sab','Dom'].forEach(d => {
                container.innerHTML += `<div class="bg-white p-4 rounded-xl border border-slate-100 min-h-[150px]"><h3 class="font-bold text-slate-700 border-b border-slate-50 pb-2 mb-2">${d}</h3></div>`;
            });
        }
        function renderRoutine() {
            document.getElementById('habit-tracker-container').innerHTML = '<p class="text-slate-500">Seus h√°bitos aparecer√£o aqui.</p>';
        }

        // --- AI CHAT ---
        function toggleAIChat() {
            const win = document.getElementById('ai-chat-window');
            win.style.display = win.style.display === 'flex' ? 'none' : 'flex';
            if(win.style.display === 'flex') win.classList.add('open');
        }
        function handleAIChat(e) {
            e.preventDefault();
            const input = document.getElementById('ai-chat-input');
            const list = document.getElementById('ai-chat-messages');
            const msg = input.value;
            if(!msg) return;
            
            // User Msg
            list.innerHTML += `<div class="flex justify-end"><div class="bg-indigo-600 text-white p-3 rounded-2xl rounded-tr-none text-sm max-w-[85%] shadow-sm">${msg}</div></div>`;
            input.value = '';
            
            // Bot Response (Simulated)
            setTimeout(() => {
                let reply = "Interessante! Vou anotar isso.";
                if(msg.includes('meta')) reply = "Definir metas claras aumenta sua chance de sucesso em 42%. Que tal quebrar essa meta em passos menores?";
                if(msg.includes('estud')) reply = "Para estudos, recomendo sess√µes de 25 minutos (Pomodoro). Quer iniciar o timer?";
                if(msg.includes('dinheiro') || msg.includes('gasto')) reply = "Estou monitorando suas finan√ßas. Lembre-se da regra 50/30/20.";
                
                list.innerHTML += `<div class="flex justify-start"><div class="bg-white border border-slate-200 text-slate-700 p-3 rounded-2xl rounded-tl-none text-sm max-w-[85%] shadow-sm">${reply}</div></div>`;
                list.scrollTop = list.scrollHeight;
            }, 800);
        }

        // --- TIMER ---
        let timerTime = 25 * 60; let timerRunning = false; let timerInt;
        function toggleStudyTimer() {
            if(timerRunning) { clearInterval(timerInt); timerRunning = false; document.getElementById('nexus-timer-btn').innerText = "Focar"; }
            else {
                timerRunning = true; document.getElementById('nexus-timer-btn').innerText = "Pausar";
                timerInt = setInterval(() => {
                    timerTime--;
                    const m = Math.floor(timerTime/60).toString().padStart(2,'0');
                    const s = (timerTime%60).toString().padStart(2,'0');
                    document.getElementById('nexus-timer').innerText = `${m}:${s}`;
                    if(timerTime <= 0) { clearInterval(timerInt); alert("Tempo esgotado!"); timerRunning = false; timerTime = 25*60; }
                }, 1000);
            }
        }

        // Init
        init();
    </script>
</body>
</html>